{"version":3,"sources":["webpack:///webpack/bootstrap ccf316355598529060ac","webpack:///external \"gulp-util\"","webpack:///./src/GulpSassPedigree.js","webpack:///./src/Helpers.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///./src/DependenciesGraph.js","webpack:///./src/stripScssImports.js","webpack:///external \"through2\""],"names":["create","PLUGIN_NAME","green","colors","msg","getFileChangedArgs","graph","file","dir","dirname","path","dirs","relative","base","push","contents","toString","concat","options","includePaths","verbose","study","studyProjectStructure","enc","cb","isNull","onFileChange","obj","getAncestors","getAncestorsFromFile","start","Date","now","parents","get","length","ancestors","ascend","slice","e","i","p","File","cwd","type","createReadStream","readFileSync","filename","JSON","stringify","basename","info","magenta","prune","fileExists","log","arr","filter","child","list","lastIndexOf","existsSync","color","args","DependenciesGraph","Object","assign","children","oldDeps","newDeps","cache","_options","ext","res","shift","dep","content","imports","updateKeys","createStack","record","updateChildren","updateParents","k","forEach","indexOf","files","importer","reduce","a","resolve","b","replace","v","keys","stripScssImports","textContent","match","split","map"],"mappings":"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","file":"GulpSassPedigree.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ccf316355598529060ac","module.exports = require(\"gulp-util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"gulp-util\"\n// module id = 0\n// module chunks = 0","import through from 'through2';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport gutil from 'gulp-util';\r\nimport {DependenciesGraph} from './DependenciesGraph';\r\nimport {log} from './Helpers';\r\n\r\nexport const PLUGIN_NAME = 'gulp-sass-pedigree';\r\nconst green = msg => gutil.colors.green(msg);\r\nconst getFileChangedArgs = (graph, file) => {\r\n  let dir = path.dirname(file.path);\r\n  let dirs = [dir];\r\n\r\n  if(path.relative(dir, file.base)) {\r\n    dirs.push(file.base);\r\n  }\r\n\r\n  return [\r\n    file, file.contents.toString(), dirs.concat(graph.options.includePaths)\r\n  ];\r\n};\r\n\r\nexport function create(options = {}) {\r\n  const graph = new DependenciesGraph();\r\n  graph.options = options;\r\n  graph.options.verbose = !!graph.options.verbose;\r\n\r\n  return {\r\n    graph,\r\n\r\n    study() {\r\n\r\n      function studyProjectStructure(file, enc, cb) {\r\n        if(file && !file.isNull()) {\r\n          void graph.onFileChange(...getFileChangedArgs(graph, file));\r\n        }\r\n\r\n        return cb(null, file);\r\n      }\r\n\r\n      return through.obj(studyProjectStructure);\r\n    },\r\n\r\n    getAncestors() {\r\n      function getAncestorsFromFile(file, enc, cb) {\r\n        if(file && !file.isNull()) {\r\n          let start = Date.now();\r\n\r\n          void graph.onFileChange(...getFileChangedArgs(graph, file));\r\n          let parents = graph.get(file.path).parents;\r\n\r\n          if(parents.length) {\r\n            let ancestors;\r\n\r\n            try {\r\n              ancestors = graph.ascend(parents.slice());\r\n            } catch(e) {\r\n\r\n              log('warn', 'possible circular dependency', e);\r\n            }\r\n\r\n            if(ancestors) {\r\n              for(let i = 0; i < ancestors.length; i++) {\r\n                let p = ancestors[i];\r\n\r\n                this.push(\r\n                  /* eslint object-property-newline: 0 */\r\n                  new gutil.File({\r\n                    path: p, cwd: file.cwd, base: path.dirname(p),\r\n                    contents: file.type === 'stream'\r\n                      ? fs.createReadStream(p) : fs.readFileSync(p)\r\n                  })\r\n                );\r\n              }\r\n\r\n              let filename = green(JSON.stringify(path.basename(file.path)));\r\n              let info = [\r\n                `${green(ancestors.length)} ancestors for ${filename}`\r\n              ];\r\n\r\n              if(graph.options.verbose) {\r\n                info.push(green(JSON.stringify(ancestors, null, 2)));\r\n              }\r\n\r\n              log('info', ...info,\r\n                gutil.colors.magenta(`${Date.now() - start} ms`)\r\n              );\r\n            }\r\n\r\n          }\r\n        }\r\n\r\n        return cb(null, file);\r\n      }\r\n\r\n      return through.obj(getAncestorsFromFile);\r\n    }\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/GulpSassPedigree.js","import gutil from 'gulp-util';\r\nimport fs from 'fs';\r\nimport {PLUGIN_NAME} from './GulpSassPedigree';\r\n\r\nexport function prune(arr) {\r\n  return arr.filter((child, i, list) => child && i === list.lastIndexOf(child));\r\n}\r\n\r\nexport function fileExists(path) {\r\n  return fs.existsSync(path);\r\n}\r\n\r\nexport function log(type, ...args) {\r\n  let color;\r\n\r\n  switch(type) {\r\n    case 'warn':\r\n      color = 'yellow';\r\n      break;\r\n\r\n    case 'error':\r\n      color = 'red';\r\n      break;\r\n\r\n    default:\r\n      color = 'cyan';\r\n  }\r\n\r\n  return gutil.log(\r\n    gutil.colors[color](`${PLUGIN_NAME}::${type}`), ...args\r\n  );\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Helpers.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 4\n// module chunks = 0","import path from 'path';\r\nimport gutil from 'gulp-util';\r\nimport {prune, fileExists, log as logger} from './Helpers';\r\nimport {stripScssImports} from './stripScssImports';\r\n\r\nexport class DependenciesGraph {\r\n  static createStack() {\r\n\r\n    return Object.assign(Object.create(null), {children: [], parents: []});\r\n  }\r\n\r\n  static updateChildren(oldDeps, newDeps) {\r\n\r\n    return prune([].concat(newDeps));\r\n  }\r\n\r\n  constructor() {\r\n    this.cache = Object.create(null);\r\n    this._options = Object.assign(Object.create(null), {\r\n      includePaths: [],\r\n      ext: '.scss',\r\n      verbose: false\r\n    });\r\n\r\n    this.log = logger;\r\n    this.fileExists = fileExists;\r\n  }\r\n\r\n  set options(v) {\r\n\r\n    this._options = Object.assign(this._options, v || {});\r\n  }\r\n  get options() {\r\n\r\n    return this._options;\r\n  }\r\n  get length() {\r\n\r\n    return Object.keys(this.cache).length;\r\n  }\r\n\r\n  get(path) {\r\n\r\n    return this.cache[path] || null;\r\n  }\r\n\r\n  ascend(list, res = []) {\r\n    if(!list.length) {\r\n      return prune(res);\r\n    }\r\n\r\n    let p = list.shift();\r\n    let dep = this.cache[p];\r\n\r\n    return dep.parents.length\r\n      ? this.ascend(list.concat(dep.parents), res)\r\n      : this.ascend(list, res.concat(p))\r\n      ;\r\n  }\r\n\r\n  onFileChange(file, content = '', dirs = []) {\r\n    let imports = this.updateKeys(stripScssImports(content), dirs, file.path);\r\n\r\n    if(!(file.path in this.cache)) {\r\n      this.cache[file.path] = DependenciesGraph.createStack();\r\n    }\r\n\r\n    let record = this.get(file.path);\r\n    record.children = DependenciesGraph.updateChildren(null, imports);\r\n\r\n    void this.updateParents();\r\n  }\r\n\r\n  updateParents() {\r\n    for(let k in this.cache) {\r\n      // noinspection JSUnfilteredForInLoop\r\n      this.cache[k].parents = [];\r\n    }\r\n\r\n    for(let k in this.cache) {\r\n      // noinspection JSUnfilteredForInLoop\r\n      this.cache[k]\r\n        .children\r\n        .forEach(file => {\r\n\r\n          // noinspection JSUnfilteredForInLoop\r\n          if(!~this.cache[file].parents.indexOf(k)) {\r\n            // noinspection JSUnfilteredForInLoop\r\n            this.cache[file].parents.push(k);\r\n          }\r\n        })\r\n      ;\r\n    }\r\n  }\r\n\r\n\r\n  updateKeys(files, dirs, importer) {\r\n\r\n    return files\r\n      .reduce((res, filename) => {\r\n        for(let i = 0; i < dirs.length; i++) {\r\n          let dir = dirs[i];\r\n          let a = path.resolve(dir, filename);\r\n          let b = a.replace(/([^/\\\\]*$)/, '_$1');\r\n\r\n          if(a in this.cache) {\r\n\r\n            return res.concat(a);\r\n          }\r\n\r\n          if(b in this.cache) {\r\n\r\n            return res.concat(b);\r\n          }\r\n\r\n          if(this.fileExists(a)) {\r\n            this.cache[a] = DependenciesGraph.createStack();\r\n\r\n            return res.concat(a);\r\n          }\r\n\r\n          if(this.fileExists(b)) {\r\n            this.cache[b] = DependenciesGraph.createStack();\r\n\r\n            return res.concat(b);\r\n          }\r\n        }\r\n\r\n        this.log(\r\n          'warn',\r\n          `${\r\n            gutil.colors.green(JSON.stringify(filename))\r\n            } not found in ${\r\n            gutil.colors.green(JSON.stringify(dirs, null, 2))\r\n            } of ${\r\n            gutil.colors.green(JSON.stringify(path.basename(importer)))\r\n            }`\r\n        );\r\n\r\n        return res;\r\n      }, [])\r\n      ;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/DependenciesGraph.js","export function stripScssImports(textContent) {\r\n\r\n  return (\r\n    // TODO: Handle comments //@import \"\"; or /* @import \"\"; */\r\n    textContent.match(/(?:@import\\s+)([^;]*)/g) || []\r\n  )\r\n    .reduce((res, filename) => res.concat(\r\n      filename\r\n        .replace(/@import|[\"'\\s]/g, '')\r\n        .split(/,/)\r\n        .map(p => `${p.replace(/\\.scss$/, '')}.scss`)\r\n      )\r\n      , [])\r\n    ;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/stripScssImports.js","module.exports = require(\"through2\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"through2\"\n// module id = 7\n// module chunks = 0"],"sourceRoot":""}