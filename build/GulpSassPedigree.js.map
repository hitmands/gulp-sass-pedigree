{"version":3,"sources":["webpack:///webpack/bootstrap 062ffa7ddb3293378a98","webpack:///external \"gulp-util\"","webpack:///./src/GulpSassPedigree.js","webpack:///./src/Helpers.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///./src/DependenciesGraph.js","webpack:///./src/stripScssImports.js","webpack:///external \"through2\""],"names":["create","PLUGIN_NAME","options","graph","verbose","study","studyProjectStructure","file","enc","cb","isNull","dir","dirname","path","dirs","relative","base","push","onFileChange","contents","toString","concat","includePaths","obj","getAncestors","getAncestorsFromFile","start","Date","now","parents","get","length","ancestors","ascend","slice","forEach","File","cwd","p","type","createReadStream","readFileSync","origin","colors","green","JSON","stringify","basename","info","magenta","prune","fileExists","log","arr","filter","child","i","list","lastIndexOf","existsSync","color","args","DependenciesGraph","Object","assign","children","oldDeps","newDeps","cache","_options","ext","res","shift","dep","content","imports","updateKeys","createStack","record","updateChildren","updateParents","k","indexOf","files","importer","reduce","filename","a","resolve","b","replace","v","keys","stripScssImports","textContent","match","split","map"],"mappings":"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","file":"GulpSassPedigree.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 062ffa7ddb3293378a98","module.exports = require(\"gulp-util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"gulp-util\"\n// module id = 0\n// module chunks = 0","import through from 'through2';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport gutil from 'gulp-util';\r\n\r\nimport {DependenciesGraph} from './DependenciesGraph';\r\nimport {log} from './Helpers';\r\n\r\nexport const PLUGIN_NAME = 'gulp-sass-pedigree';\r\n\r\n\r\nexport function create(options = {}) {\r\n  const graph = new DependenciesGraph();\r\n  graph.options = options;\r\n  graph.options.verbose = !!graph.options.verbose;\r\n\r\n  return {\r\n    graph,\r\n\r\n    study() {\r\n\r\n      function studyProjectStructure(file, enc, cb) {\r\n\r\n        if(file && !file.isNull()) {\r\n          let dir = path.dirname(file.path);\r\n          let dirs = [dir];\r\n          if(path.relative(dir, file.base)) {\r\n            dirs.push(file.base);\r\n          }\r\n          void graph.onFileChange(\r\n            file,\r\n            file.contents.toString(),\r\n            dirs.concat(graph.options.includePaths)\r\n          );\r\n        }\r\n\r\n        return cb(null, file);\r\n      }\r\n\r\n      return through.obj(studyProjectStructure);\r\n    },\r\n\r\n    getAncestors() {\r\n      function getAncestorsFromFile(file, enc, cb) {\r\n        let start = Date.now();\r\n\r\n        if(!file || file.isNull()) {\r\n          return cb(null, file);\r\n        }\r\n\r\n        let dir = path.dirname(file.path);\r\n        let dirs = [dir];\r\n        if(path.relative(dir, file.base)) {\r\n          dirs.push(file.base);\r\n        }\r\n        void graph.onFileChange(\r\n          file,\r\n          file.contents.toString(),\r\n          dirs\r\n        );\r\n\r\n        let parents = graph.get(file.path).parents;\r\n\r\n        if(parents.length) {\r\n          let ancestors = graph.ascend(parents.slice());\r\n\r\n          ancestors\r\n            .forEach(p => {\r\n              this.push(\r\n                new gutil.File({\r\n                  cwd: file.cwd,\r\n                  path: p,\r\n                  base: path.dirname(p),\r\n                  contents: file.type === 'stream'\r\n                    ? fs.createReadStream(p) : fs.readFileSync(p)\r\n                })\r\n              );\r\n            })\r\n          ;\r\n\r\n          let origin = gutil.colors.green(JSON.stringify(path.basename(file.path)));\r\n          let info = [\r\n            `${gutil.colors.green(ancestors.length)} ancestors for ${origin}`\r\n          ];\r\n\r\n          if(graph.options.verbose) {\r\n            info.push(gutil.colors.green(JSON.stringify(ancestors, null, 2)));\r\n          }\r\n\r\n          log('info',\r\n            ...info,\r\n            gutil.colors.magenta(`${Date.now() - start} ms`)\r\n          );\r\n        }\r\n\r\n        return cb(null, file);\r\n      }\r\n\r\n      return through.obj(getAncestorsFromFile);\r\n    }\r\n  };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/GulpSassPedigree.js","import gutil from 'gulp-util';\r\nimport fs from 'fs';\r\nimport {PLUGIN_NAME} from './GulpSassPedigree';\r\n\r\nexport function prune(arr) {\r\n  return arr.filter((child, i, list) => child && i === list.lastIndexOf(child));\r\n}\r\n\r\nexport function fileExists(path) {\r\n  return fs.existsSync(path);\r\n}\r\n\r\nexport function log(type, ...args) {\r\n  let color;\r\n\r\n  switch(type) {\r\n    case 'warn':\r\n      color = 'yellow';\r\n      break;\r\n\r\n    case 'error':\r\n      color = 'red';\r\n      break;\r\n\r\n    default:\r\n      color = 'cyan';\r\n  }\r\n\r\n  return gutil.log(\r\n    gutil.colors[color](`${PLUGIN_NAME}::${type}`), ...args\r\n  );\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Helpers.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 4\n// module chunks = 0","import path from 'path';\r\nimport gutil from 'gulp-util';\r\nimport {prune, fileExists, log as logger} from './Helpers';\r\nimport {stripScssImports} from './stripScssImports';\r\n\r\nexport class DependenciesGraph {\r\n  static createStack() {\r\n\r\n    return Object.assign(Object.create(null), {children: [], parents: []});\r\n  }\r\n\r\n  static updateChildren(oldDeps, newDeps) {\r\n\r\n    return prune([].concat(newDeps));\r\n  }\r\n\r\n  constructor() {\r\n    this.cache = Object.create(null);\r\n    this._options = Object.assign(Object.create(null), {\r\n      includePaths: [],\r\n      ext: '.scss',\r\n      verbose: false\r\n    });\r\n\r\n    this.log = logger;\r\n    this.fileExists = fileExists;\r\n  }\r\n\r\n  set options(v) {\r\n\r\n    this._options = Object.assign(this._options, v || {});\r\n  }\r\n  get options() {\r\n\r\n    return this._options;\r\n  }\r\n  get length() {\r\n\r\n    return Object.keys(this.cache).length;\r\n  }\r\n\r\n  get(path) {\r\n\r\n    return this.cache[path] || null;\r\n  }\r\n\r\n  ascend(list, res = []) {\r\n    if(!list.length) {\r\n      return prune(res);\r\n    }\r\n\r\n    let p = list.shift();\r\n    let dep = this.cache[p];\r\n\r\n    return dep.parents.length\r\n      ? this.ascend(list.concat(dep.parents), res)\r\n      : this.ascend(list, res.concat(p))\r\n      ;\r\n  }\r\n\r\n  onFileChange(file, content = '', dirs = []) {\r\n    let imports = this.updateKeys(stripScssImports(content), dirs, file.path);\r\n\r\n    if(!(file.path in this.cache)) {\r\n      this.cache[file.path] = DependenciesGraph.createStack();\r\n    }\r\n\r\n    let record = this.get(file.path);\r\n    record.children = DependenciesGraph.updateChildren(null, imports);\r\n\r\n    void this.updateParents();\r\n  }\r\n\r\n  updateParents() {\r\n    for(let k in this.cache) {\r\n      // noinspection JSUnfilteredForInLoop\r\n      this.cache[k].parents = [];\r\n    }\r\n\r\n    for(let k in this.cache) {\r\n      // noinspection JSUnfilteredForInLoop\r\n      this.cache[k]\r\n        .children\r\n        .forEach(file => {\r\n\r\n          // noinspection JSUnfilteredForInLoop\r\n          if(!~this.cache[file].parents.indexOf(k)) {\r\n            // noinspection JSUnfilteredForInLoop\r\n            this.cache[file].parents.push(k);\r\n          }\r\n        })\r\n      ;\r\n    }\r\n  }\r\n\r\n\r\n  updateKeys(files, dirs, importer) {\r\n\r\n    return files\r\n      .reduce((res, filename) => {\r\n        for(let i = 0; i < dirs.length; i++) {\r\n          let dir = dirs[i];\r\n          let a = path.resolve(dir, filename);\r\n          let b = a.replace(/([^/\\\\]*$)/, '_$1');\r\n\r\n          if(a in this.cache) {\r\n\r\n            return res.concat(a);\r\n          }\r\n\r\n          if(b in this.cache) {\r\n\r\n            return res.concat(b);\r\n          }\r\n\r\n          if(this.fileExists(a)) {\r\n            this.cache[a] = DependenciesGraph.createStack();\r\n\r\n            return res.concat(a);\r\n          }\r\n\r\n          if(this.fileExists(b)) {\r\n            this.cache[b] = DependenciesGraph.createStack();\r\n\r\n            return res.concat(b);\r\n          }\r\n        }\r\n\r\n        this.log(\r\n          'warn',\r\n          `${\r\n            gutil.colors.green(JSON.stringify(filename))\r\n            } not found in ${\r\n            gutil.colors.green(JSON.stringify(dirs, null, 2))\r\n            } of ${\r\n            gutil.colors.green(JSON.stringify(path.basename(importer)))\r\n            }`\r\n        );\r\n\r\n        return res;\r\n      }, [])\r\n      ;\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/DependenciesGraph.js","export function stripScssImports(textContent) {\r\n\r\n  return (\r\n    // TODO: Handle comments //@import \"\"; or /* @import \"\"; */\r\n    textContent.match(/(?:@import\\s+)([^;]*)/g) || []\r\n  )\r\n    .reduce((res, filename) => res.concat(\r\n      filename\r\n        .replace(/@import|[\"'\\s]/g, '')\r\n        .split(/,/)\r\n        .map(p => `${p.replace(/\\.scss$/, '')}.scss`)\r\n      )\r\n      , [])\r\n    ;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/stripScssImports.js","module.exports = require(\"through2\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"through2\"\n// module id = 7\n// module chunks = 0"],"sourceRoot":""}